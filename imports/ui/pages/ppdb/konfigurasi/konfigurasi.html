<template name="konfigurasi">
  {{#if isInRole 'superadmin, adminPpdbYayasan  '}}
  <div class="container">
    <div class="contentAtas">
      <p style="color: blue; margin: 0;"> <a href="/"> Beranda</a> / <a href="/ppdb">
          PPDB</a></p>
    </div>
    <div class="page-title">
      <h3>Konfigurasi PPDB</h3>
    </div>
    <hr>
    <div class="page-content">
      <div class="section-tabmenu">
        <div class="tab-container">
          <ul class="tab-menu">
            <li class="tab-item " data-tab="tab1">Tahun Ajaran</li>
            <li class="tab-item " data-tab="tab2">Konfigurasi VA</li>
            <li class="tab-item" data-tab="tab4">Perwakilan</li>
            <li class="tab-item active" data-tab="tab6">Sekolah</li>
            <li class="tab-item" data-tab="tab5">Pengguna</li>
          </ul>
          <div class="tab-content">
            <div class="tab-pane " id="tab1">
              {{> periodePpdb accessAdd=true}}
            </div>
            <div class="tab-pane " id="tab2">
              {{> konfigurasiVa}}
            </div>
            <div class="tab-pane" id="tab4">
              {{> listPerwakilan}}
            </div>
            <div class="tab-pane active" id="tab6">
              {{> listSchools}}
            </div>
            <div class="tab-pane" id="tab5">
              {{> listUser}}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {{else}}
  {{> konfigurasiSchool}}
  {{/if}}
</template>
<template name="konfigurasiVa">
  <div class="container">
    <div class="page-title">
      <h3>Daftar Konfigurasi VA</h3>
      <div class="form-group">
        <!-- <div class="btn btn-outline-info btn-view-mode" data-target="0">Perwakilan</div> -->
        <!-- <div class="btn btn-outline-info btn-view-mode" data-target="1">Sekolah</div> -->
        <!-- <div class="btn btn-outline-info btn-view-mode" data-target="2">Tag</div> -->
      </div>
    </div>
    <div class="page-action">
      <button class="btn btn-primary float-right" id="btn-add" data-toggle="modal" data-target="#addModal">+
        Tambah</button>
    </div>
    <div class="page-body">
      <table class="table table-group-divider">
        <thead>
          <th>No.</th>
          <th>Nama</th>
          <th>Kode VA Perwakilan</th>
          <th>Aksi</th>
        </thead>
        <tbody>
          {{#each items}}
          <tr>
            <td>
              {{getNumber @index}}
            </td>
            <td>
              {{unitName}}
            </td>
            <td>
              {{code}}
            </td>
            <td>
              <button class="btn btn-primary" id="btn-update">Ubah</button>
              <button class="btn btn-danger" id="btn-remove">Hapus</button>
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
      <hr>
      <nav>
        <ul class="pagination">
          {{#each getPageNumbers totalPages}}
          <li class="{{isActive this}}"><a href="#" class="page-link" data-page="{{this}}">{{this}}</a></li>
          {{/each}}
        </ul>
      </nav>
    </div>
  </div>

  <!-- Modal Add -->
  <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addModalLabel">Form Tambah Kode</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Pilih Kategori</label>
            <select class="form-control" id="select-category">
              <option value="0">-- Pilih Kategori --</option>
              <option value="unit">Perwakilan</option>
              <!-- <option value="school">Sekolah</option> -->
              <option value="type">Tipe Transaksi</option>
            </select>
          </div>
          {{#if equals viewList '0'}}

          {{else}}
          {{#if equals viewList 'unit'}}
          {{> c_selectPerwakilan}}
          {{/if}}
          {{#if equals viewList 'school'}}
          {{> c_selectSchools}}
          {{/if}}
          {{#if equals viewList 'type'}}
          <div class="form-group">
            <label>Pilih Post Tagihan</label>
            <select class="form-control" id="select-post">
              <option value="formulir">Formulir</option>
              <option value="spp">SPP</option>
              <option value="cicilan">cicilan</option>
            </select>
          </div>
          {{/if}}
          <div class="form-group">
            <label>Kode Perwakilan</label>
            <input type="number" id="input-code" class="form-control" />
          </div>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
          <button type="button" class="btn btn-primary" id="btn-save-modal">Simpan</button>
          {{/if}}

        </div>
        <div class="modal-footer">
        </div>
      </div>
    </div>
  </div>
</template>
<template name="periodePpdb">
  <div class="container">
    <div class="page-title my-3">
      <h3>Periode Tahun Ajaran PPDB</h3>
    </div>
    <div class="page-content">
      {{#if accessAdd}}
      <div class="section-action mb-2">
        <button class="btn btn-primary float-right" id="btn-add">+
          Tambah Periode PPDB</button>
      </div>
      {{/if}}
      <table class=" table table-group-divider">
        <thead>
          <th>Nomor</th>
          <th>Nama</th>
          <th>Tahun Ajaran</th>
          <th>Status</th>
        </thead>
        <tbody>
          {{#each periodePpdb}}
          <tr>
            <td>
              {{nomorUrut @index}}
            </td>
            <td>
              {{name}}
            </td>
            <td>
              {{year}}
            </td>
            <td>
              {{#if isInRole 'adminPpdbYayasan, superadmin'}}
              <label class="switch">
                {{#if status}}
                <input type="checkbox" id="toggleSwitch" milik="{{_id}}" checked>
                {{else}}
                <input type="checkbox" id="toggleSwitch" milik="{{_id}}">
                {{/if}}
                <span class="slider round">

                </span>
              </label>
              {{/if}}
              {{#if status}}
              Aktif
              {{else}}
              Tidak Aktif
              {{/if}}
            </td>
            {{#if isInRole 'superadmin, adminPpdbYayasan'}}
            <button class="btn btn-primary btn-update" data-toggle="modal" data-target="#editModalPeriode">Ubah</button>
            {{/if}}
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>
    {{> c_modal title='Tambah Periode Tahun Ajaran' idModal="addModalVaGenerate" bodyTemplate="formInputPeriode" bodyData=yourFormData formId="addForm"}}
  </div>
</template>
<template name="formInputPeriode">
  <div class="form-group">
    <label for="inputName">Nama</label>
    <input type="text" class="form-control" id="inputName" placeholder="Contoh : Periode Tahun Ajaran 2024/2025"
      required value="{{name}}">
  </div>
  <div class="form-group">
    <label for="inputTahunAjaran">Tahun Ajaran</label>
    <input type="text" class="form-control" id="inputTahunAjaran" placeholder="Contoh: 2024/2025" required
      value="{{tahunAjaran}}">
  </div>
  <div class="form-group">
    <label for="inputCodePeriode">Kode Tahun Ajaran</label>
    <input type="text" class="form-control" id="inputCodePeriode"
      placeholder="Contoh: 2425 (Jika Tahun Ajaran 2024/2025)" required value="{{code}}">
  </div>
</template>

<!-- Konfigurasi Sekolah -->
<template name="konfigurasiSchool">
  {{#if isInRole 'superadmin, adminPpdbSchool'}}
  <div class="container mt-5">
    <div class="contentAtas">
      <p style="color: blue; margin: 0;"> <a href="/"> Beranda</a> / <a href="/ppdb">
          PPDB</a></p>
    </div>
    <div class="page-title">
      <h3>Konfigurasi PPDB</h3>
    </div>
    <div class="page-content">
      <div class="section-tabmenu">
        <div class="tab-container">
          <ul class="tab-menu">
            <li class="tab-item active" data-tab="tab1">Tahun Ajaran</li>
            <li class="tab-item " data-tab="tab2">Gelombang</li>
            <!-- <li class="tab-item " data-tab="tab3">Pembayaran</li> -->
          </ul>
          <div class="tab-content">
            <div class="tab-pane active " id="tab1">
              {{> periodePpdb accessAdd=false}}
            </div>
            <div class="tab-pane " id="tab2">
              {{> gelombangPage }}
            </div>
            <!-- <div class="tab-pane " id="tab3">
              {{> paymentConfigSchool}}
            </div> -->
          </div>
        </div>
      </div>
    </div>
  </div>
  {{else}}
  <center>Maaf , Anda belum memiliki akses</center>
  {{/if}}
</template>

<template name="gelombangPage">
  <div class="container">
    <div class="page-title">
      <h3>Gelombang PPDB</h3>

      {{#if isActiveGel}}
      <div class="alert alert-success" role="alert">
        Gelombang yang aktif :
        <ul>
          {{#each isActiveGel}}
          <li>{{name}}</li>
          {{/each}}
        </ul>
      </div>
      {{else}}
      <div class="alert alert-danger" role="alert">
        Tidak ada Gelombang Aktif
      </div>

      {{/if}}
    </div>
    <div class="page-content">
      <div class="section-action">
        <div class="section-action mb-2">
          <button class="btn btn-primary float-right" id="btn-add" data-toggle="modal"
            data-target="#addModalGelombang">+
            Tambah Gelombang PPDB</button>
        </div>
      </div>
      <table class="table table-group-divider mt-5">
        <thead>
          <th>Nomor</th>
          <th>Nama Gelombang</th>
          <th>Kode Gelombang</th>
          <th>Status</th>
          <th>Va Status</th>
          <th>Aksi</th>
        </thead>
        <tbody>
          {{#each listGelombang}}
          <tr>
            <td>{{nomorUrut @index}}</td>
            <td>{{name}}</td>
            <td>{{code}}</td>
            <td>{{#if status}}Aktif{{else}}Non Aktif{{/if}}</td>
            <td>
              {{#if haveVa}}
              VA Belum Aktif : {{vaDeActivated}} | Va Aktif : {{vaActivated}} | Va Terpakai : {{vaUsed}}
              {{else}}
              Belum Ada VA
              {{/if}}
            </td>
            <td>
              <label class="switch">
                {{#if status}}
                <input type="checkbox" id="toggleSwitch" milik="{{_id}}" checked>
                {{else}}
                <input type="checkbox" id="toggleSwitch" milik="{{_id}}">
                {{/if}}
                <span class="slider round">

                </span>
              </label>
              <button class="btn btn-info" id="btn-update" milik="{{_id}}">Ubah</button>
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
      {{> c_modal title='Tambah Gelombang' idModal="addModalGelombang" bodyTemplate="formAddGelombang"  formId="addForm" type="modal-xl"}}
    </div>
  </div>
</template>

<template name="paymentConfigSchool">
  <div class="container">
    <div class="page-title">
      <h3>Pembayaran PPDB</h3>
    </div>
    <div class="page-content">
      <div class="section-action">
        <div class="section-action mb-2">
          <button class="btn btn-primary float-right" id="btn-add" data-toggle="modal" data-target="#addModalPayment">+
            Tambah Daftar Pembayaran</button>
        </div>
      </div>
      <table class="table table-group-divider mt-5">
        <thead>
          <th>Nomor</th>
          <th>Nama</th>
          <th>Kategori</th>
          <th>Status</th>
          <th>Aksi</th>
        </thead>
        <tbody>
          {{#each listPaymentConfig}}
          <tr>
            <td>{{nomorUrut @index}}</td>
            <td>{{name}}</td>
            <td>{{category}}</td>
            <td>{{formatRp nominal}}</td>


          </tr>
          {{/each}}
        </tbody>
      </table>
      {{> c_modal title='Tambah Daftar Pembayaran' idModal="addModalPayment" bodyTemplate="formAddPaymentSchool"  formId="addForm"}}

    </div>

  </div>
</template>